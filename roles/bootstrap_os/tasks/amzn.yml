---
- name: Gather host facts to get ansible_distribution_version ansible_distribution_major_version
  setup:
    gather_subset: '!all'
    filter: ansible_distribution_*version

- name: Enable selinux-ng repo for Amazon Linux for container-selinux
  command: amazon-linux-extras enable selinux-ng
  when:
    - (ansible_distribution_version | float) == 2

- name: Enable EPEL repo for Amazon Linux
  yum_repository:
    name: epel
    file: epel
    description: Extra Packages for Enterprise Linux 7 - $basearch
    baseurl: http://download.fedoraproject.org/pub/epel/7/$basearch
    gpgcheck: true
    gpgkey: http://download.fedoraproject.org/pub/epel/RPM-GPG-KEY-EPEL-7
    skip_if_unavailable: true
    enabled: true
    repo_gpgcheck: false
  when:
    - epel_enabled
    - (ansible_distribution_version | float) == 2