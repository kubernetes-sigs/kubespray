{%- set default_config = {
  "csi-auth-check": "true" if external_vsphere_version >= "7.0" else "false",
  "online-volume-extend": "true",
  "trigger-csi-fullsync": "false",
  "async-query-volume": "true",
  "block-volume-snapshot": "true",
  "csi-windows-support": "false",
  "list-volumes": "true",
  "pv-to-backingdiskobjectid-mapping": "false",
  "cnsmgr-suspend-create-volume": "true",
  "topology-preferential-datastores": "true",
  "max-pvscsi-targets-per-vm": "true",
  "multi-vcenter-csi-topology": "true",
  "csi-internal-generated-cluster-id": "true",
  "listview-tasks": "true",
  "improved-csi-idempotency": "true",
  "improved-volume-topology": "true",
  "use-csinode-id": "true",
  "list-volumes": "false"
} -%}
{%- set merged = default_config | ansible.builtin.combine(vsphere_csi_controller_config_override) -%}
apiVersion: v1
data:
{% for key, value in merged.items() %}
  "{{ key }}": "{{ value | string }}"
{% endfor %}
kind: ConfigMap
metadata:
  name: internal-feature-states.csi.vsphere.vmware.com
  namespace: "{{ vsphere_csi_namespace }}"
